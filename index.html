<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0a0a0a" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <link rel="icon" href="/assets/icons/icon-192.png" />
  <link rel="stylesheet" href="/css/globals.css" />
  <title>Facetime caller</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="bg-neutral-950 text-neutral-100">
  <div id="login-root" class="flex items-center justify-center h-screen">
    <button id="tg-login-btn" class="btn">Войти</button>
  </div>
  <div id="app" class="hidden">
    <div id="messages" class="message-list"></div>

    <form id="messageForm" class="layout-stack p-4">
      <input id="message" class="input mb-2" type="text" autocomplete="off" />
      <button id="sendBtn" type="button" class="btn">Send</button>
    </form>
  </div>
<div id="participants"></div>

  <script type="module">
    import '/js/app.js';
    import { initTelegramAuthUI, isAuthenticated } from '/js/auth-tg.js';
    import { SUPABASE_URL, TELEGRAM_BOT_USERNAME } from '/config/config.js';

    const loginRoot = document.getElementById('login-root');
    const app = document.getElementById('app');
    const loginBtn = document.getElementById('tg-login-btn');

    function showApp() {
      loginRoot.style.display = 'none';
      app.classList.remove('hidden');
    }

    if (isAuthenticated()) {
      showApp();
    } else {
      loginBtn.addEventListener('click', () => {
        loginBtn.remove();
        initTelegramAuthUI({
          botUsername: TELEGRAM_BOT_USERNAME,
          functionUrl: `${SUPABASE_URL}/functions/v1/tg_login`,
          containerId: 'login-root',
          onLogin: showApp
        });
      });
    }
  </script>
</body>
</html>
